<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SCIDaR Security Watch â€” September 2025</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
      /* Map container & controls (responsive) - default smaller max width */
      #map {
        width: 100%;
        max-width: 640px;           /* DEFAULT map is smaller now */
        aspect-ratio: 4 / 3;
        border: 2px solid #333;
        border-radius: 8px;
        position: relative;
        overflow: hidden;
        background: #f5f5f5;
        margin: 20px auto;
        display: block;
      }
      #map svg { width: 100%; height: 100%; display:block; }
      .zoom-buttons {
        position: absolute;
        top: 10px;
        left: 10px;
        display: flex;
        flex-direction: column;
        gap: 8px;
        z-index: 100;
      }
      .zoom-buttons button {
        padding: 8px 12px;
        font-size: 16px;
        cursor: pointer;
        border: 1px solid #ccc;
        border-radius: 4px;
        background: white;
      }

      .tooltip {
        position: absolute;
        background: rgba(0,0,0,0.9);
        color: white;
        border: 1px solid #333;
        border-radius: 4px;
        padding: 8px 12px;
        font-size: 12px;
        pointer-events: none;
        opacity: 0;
        transition: opacity .18s;
        z-index: 1000;
        box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      }

      .zone-label {
        font-size: 12px;
        font-weight: 600;
        text-anchor: middle;
        fill: #41684b;
        pointer-events: none;
      }

      /* stronger selected state visuals */
      .state.selected { stroke: #0b1220; stroke-width: 2.5; filter: drop-shadow(0 4px 12px rgba(0,0,0,0.35)); opacity:1; }
      /* stronger card highlight */
      .region.highlight {
        box-shadow: 0 0 28px rgba(28, 189, 114, 0.95);
        transform: translateY(-4px) scale(1.02);
        border-left-color: #0b8a4a !important;
        background: linear-gradient(180deg,#fffefb,#f7fff5);
        transition: all 0.28s ease;
      }

  /* Keep your other existing zoom-buttons button styles and entire styling below unchanged */
  </style>

<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

<style>
  :root{
    --bg: #f4f8fb;
    --card: #ffffff;
    --muted: #6b7280;
    --accent-1: #1f6feb;
    --accent-2: #0ea5a4;
    --danger: #ef4444;
    --warn: #f59e0b;
    --safe: #06b6d4;
    --shadow: 0 10px 30px rgba(12, 20, 40, 0.08);
    --radius: 12px;
    --max-width: 1100px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto;
    background: linear-gradient(180deg,#f4f8fb 0%, #f4fbf9 100%);
    opacity: 0.95;
    color:#0b1b2b;
    -webkit-font-smoothing:antialiased;
    line-height:1.45;
    padding:20px 16px;
    font-size:14px;
  }

  .wrap{ max-width:var(--max-width); margin:0 auto; padding: 0 20px;}

  /* Header */
  header{
    display:flex;
    gap:16px;
    align-items:center;
    background: linear-gradient(90deg,#011f10, #1cbd72);
    color:#fff;
    padding:16px;
    border-radius:var(--radius);
    box-shadow:var(--shadow);
  }
  .brand{
    width:64px; height:64px; min-width:64px;
    border-radius:10px;
    display:grid; place-items:center;
    font-weight:800; letter-spacing:0.6px;
    font-size:16px;
  }
  .header-info h1{ margin:0; font-size:18px; }
  .header-info p{ margin:4px 0 0; font-size:12px; opacity:0.95; }
  .header-meta{ margin-left:auto; text-align:right; font-size:12px; }
  .header-meta strong{ display:block; font-weight:700; }

  /* Overview */
  .overview{ 
    background:var(--card); 
    border-radius:12px; 
    padding:16px; 
    box-shadow:var(--shadow); 
    margin-top:16px;
  }
  .lead{ font-weight:600; font-size:14px; margin:0 0 12px 0; color:#071033; }
  .muted{ color:var(--muted); font-size:13px; }

  /* Stats */
  .stats{ display:flex; gap:10px; flex-wrap:wrap; margin:12px 0; }
  .stat{
    flex:1; min-width:120px;
    background:linear-gradient(180deg,#fff,#fbfdff);
    border-radius:8px; padding:10px; text-align:center;
    box-shadow: 0 4px 12px rgba(12,20,40,0.04);
  }
  .stat .num{ font-weight:800; font-size:18px; color:#0b1220; }
  .stat .lbl{ margin-top:4px; font-size:11px; color:var(--muted); line-height:1.2; }

  /* Regions - Main Focus */
  .regions-section{ margin-top:16px; }
  .regions-section h2{ margin:0 0 6px 0; font-size:16px; color:#0b1220; }
  .regions-note{ font-size:12px; color:var(--muted); margin-bottom:12px; }

  .regions{ display:grid; gap:10px; grid-template-columns: repeat(3, 1fr); }
  @media (max-width:950px){ .regions{ grid-template-columns:repeat(2,1fr) } }
  @media (max-width:650px){ .regions{ grid-template-columns:1fr } }

  .region{
    background:linear-gradient(180deg,#fff,#fbfdff);
    border-radius:10px; padding:12px; box-shadow:0 6px 18px rgba(12,20,40,0.04);
    border-left:4px solid rgba(0,0,0,0.03);
    cursor:pointer;
    transition: transform .15s ease, box-shadow .15s ease;
  }
  .region:hover{ transform:translateY(-2px); box-shadow:0 12px 24px rgba(12,20,40,0.08); }
  .region.hi{ border-left-color:var(--danger); }
  .region.med{ border-left-color:var(--warn); }
  .region.low{ border-left-color:var(--safe); }

  .region .title{ display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; }
  .region h3{ margin:0; font-size:13px; font-weight:700; }
  .tag{ font-weight:600; font-size:10px; padding:3px 6px; border-radius:12px; color:#fff; text-transform:uppercase; }
  .hi .tag{ background:var(--danger); }
  .med .tag{ background:var(--warn); }
  .low .tag{ background:var(--safe); }

  .region p{ margin:0; color:var(--muted); font-size:12px; line-height:1.4; }
  .region .impact{ font-weight:600; color:#0b1220; margin-bottom:4px; }

  .details{ 
    margin-top:8px; 
    padding-top:8px; 
    border-top:1px solid #e5e7eb; 
    display:none; 
    font-size:11px;
    line-height:1.4;
  }
  .region.active .details{ display:block; animation:fadeIn .2s ease both; }
  .details strong{ color:#0b1220; }

  /* Guidelines - Compact */
  .guidelines{ 
    margin-top:16px; 
    display:grid; 
    grid-template-columns: 1fr 1fr 1fr; 
    gap:12px; 
  }
  @media (max-width:800px){ .guidelines{ grid-template-columns:1fr } }
  
  .guide-card{ 
    background:var(--card); 
    padding:12px; 
    border-radius:8px; 
    box-shadow:0 4px 12px rgba(12,20,40,0.04); 
  }
  .guide-card h4{ margin:0 0 6px; font-size:13px; color:var(--accent-1); font-weight:600; }
  .guide-card ul{ margin:6px 0 0 14px; color:var(--muted); font-size:12px; }
  .guide-card li{ margin:3px 0; line-height:1.3; }

  header, footer {
    margin-left: -20px;
    margin-right: -20px;
  }
  /* Footer */
  footer{
    margin-top:16px; 
    padding:12px; 
    border-radius:8px; 
    background:linear-gradient(90deg,#a2c77f,#096e37);
    color:#fff; 
    display:flex; 
    justify-content:space-between; 
    align-items:center; 
    gap:12px;
    font-size:12px;
  }
  footer .right{ font-size:11px; color:rgba(255,255,255,0.8); }

  @keyframes fadeIn { from{ opacity:0; transform: translateY(4px)} to{ opacity:1; transform:none } }
  
  @media (max-width:600px){
    header{ flex-direction:column; align-items:flex-start; gap:10px; }
    .brand{ width:48px; height:48px; font-size:14px; }
    footer{ flex-direction:column; align-items:flex-start; gap:6px; }
    .zoom-buttons { gap:6px; }
    .zoom-buttons button { padding:8px; font-size:14px; }
    /* put sidebar toggle & sidebar to bottom on phones */
    .sidebar { 
      top: 80px;
      width: 180px;
      right: -190px;
      padding: 10px;
      font-size: 1px;
      max-height: 150px;
      overflow-y: auto;}
    .sidebar.open { right: 0; }
    .sidebar-toggle {top: 602px;
      width: 70px;
      right: -190px;
      padding: 10px;
      font-size: 10px;
      max-height: 80px;
      overflow-y: auto; }
  }

  /* Sidebar Styles */
  .sidebar {
    position: fixed;
    top: 100px;
    right: -240px; /* hidden off-screen */
    width: 220px;
    background: linear-gradient(180deg, #011f10, #1cbd72);
    color: white;
    padding: 16px;
    border-radius: 12px 0 0 12px;
    box-shadow: -4px 0 12px rgba(0,0,0,0.2);
    font-size: 14px;
    transition: right 0.28s ease-in-out;
    z-index: 1000;
  }

  .sidebar.open {
    right: 0; /* slide in */
  }

  .sidebar h3 {
    margin: 0 0 8px;
    font-size: 16px;
    border-bottom: 1px solid rgba(255,255,255,0.3);
    padding-bottom: 6px;
  }

  /* Toggle Button */
  .sidebar-toggle {
    position: fixed;
    bottom: 70px;
    left: 0; /* stick to left edge */
    background: #1cbd72;
    color: #fff;
    padding: 8px 10px;
    border-radius: 0 12px 12px 0; /* rounded on right */
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    box-shadow: 2px 0 6px rgba(0,0,0,0.3);
    z-index: 1001;
    transition: background 0.18s;
    /* keep it small */
  }

  .sidebar-toggle:hover {
    background: #148c54;
  }
</style>
</head>
<body>
  
  <header>
    <div class="brand">
      <img src="scidarlogo.webp" alt="SCIDaR Logo" style="width:130%; height:130%; object-fit:contain;">
    </div>
    <div class="header-info">
      <h1>SCIDaR Security Watch</h1>
      <p>September 2025 â€” Security snapshot for SCIDaR operations across Nigeria</p>
    </div>
    <div class="header-meta">
      <strong>September 2025</strong>
      <div>Security Desk briefing</div>
    </div>
  </header>

  <!-- Sidebar Toggle Button -->
  <div class="sidebar-toggle" id="toggleBtn">ðŸ“… Next Update</div>

  <!-- Sidebar -->
  <div class="sidebar" id="sidebar">
    <h3>Next Update</h3>
    <p>October 6, 2025</p>
    <small>Stay tuned for the next security briefing</small>
  </div>
    <div class="wrap">
      <div class="overview">
        <p class="lead">Situation Overview</p>
        <p class="muted">
          Nigeria's security environment remains challenging with persistent terrorism, mass abductions, banditry and highway attacks directly affecting SCIDaR operations. Recent government arrests of bandit leaders in August disrupted some networks, but insurgents maintain territorial control in several LGAs, restricting humanitarian access. Critical route disruptions (Damaturuâ€“Maiduguri) increase operational risks for staff and slow project implementation.
        </p>

        <div class="stats">
          <div class="stat">
            <div class="num" data-target="50">0+</div>
            <div class="lbl">Zamfara Abductions (August)</div>
          </div>
          <div class="stat">
            <div class="num" data-target="125" data-pct="true">0%</div>
            <div class="lbl">Southeast Attack Surge</div>
          </div>
          <div class="stat">
            <div class="num" data-target="32">0+</div>
            <div class="lbl">Recent Fatalities</div>
          </div>
          <div class="stat">
            <div class="num" data-target="3000">0</div>
            <div class="lbl">Bridge Collapse Displaced</div>
          </div>
        </div>
      </div>

      <section class="regions-section">
        <h2>Security Details across Zones</h2>
        <div class="regions-note">Threats, impacts and recommended precautions â€” click on map to navigate to the respective zone or directly click on zone to expand details</div>
        <div style="text-align: center;">
          <div id="map">
            <div class="zoom-buttons">
              <button id="zoom_in">+</button>
              <button id="zoom_out">âˆ’</button>
              <button id="reset">âŸ³</button>
            </div>
          </div>
        </div>
      <div class="tooltip" id="tooltip"></div>

        <div class="regions">
          <div class="region hi" data-region="ne">
            <div class="title">
              <h3>NORTH EAST</h3>
              <div class="tag">HIGH</div>
            </div>
            <p class="impact">Route disruption, NGO targeting, humanitarian access limited</p>
            <p>Damaturuâ€“Maiduguri route disrupted. Operational risks elevated for humanitarian workers in Borno/Yobe LGAs.</p>
            <div class="details">
              <p><strong>SCIDaR Precautions:</strong> Essential travel only to affected LGAs (Gwoza, Bama, Chibok). Daylight movement mandatory. Obtain security clearance and travel protocols from security unit before departure. Avoid late night commuting.</p>
            </div>
          </div>

          <div class="region hi" data-region="nw">
            <div class="title">
              <h3>NORTH WEST</h3>
              <div class="tag">HIGH</div>
            </div>
            <p class="impact">Mass abduction, highway attacks, territorial control</p>
            <p>50+ abducted in Zamfara (August). Bandit control in Malumfashi. Declined farming/commerce in Katsina, Sokoto, Zamfara.</p>
            <div class="details">
              <p><strong>SCIDaR Precautions:</strong> No night travel on highways. Security clearance required for high-risk areas. Share GPS location with trusted contacts. Request escort services. Vary routes to avoid profiling.</p>
            </div>
          </div>

          <div class="region med" data-region="nc">
            <div class="title">
              <h3>NORTH CENTRAL</h3>
              <div class="tag">MEDIUM</div>
            </div>
            <p class="impact">Village attacks, infrastructure damage, personnel ambush</p>
            <p>6 killed in Plateau attacks. Civil defense ambushed in Kogi. Bridge collapse in Mokwa displaced 3,000.</p>
            <div class="details">
              <p><strong>SCIDaR Precautions:</strong> High situational awareness required. Avoid Abuja-Lokoja axis risks. Secure route clearance before deployment. "Know before you go" approach mandatory.</p>
            </div>
          </div>

          <div class="region med" data-region="ss">
            <div class="title">
              <h3>SOUTH SOUTH</h3>
              <div class="tag">MEDIUM</div>
            </div>
            <p class="impact">Foreign worker targeting, drug trafficking, cyber attacks</p>
            <p>Rivers State emergency. Foreign worker kidnappings increasing. Oil bunkering and cyber threats rising.</p>
            <div class="details">
              <p><strong>SCIDaR Precautions:</strong> Reduce non-essential coastal travel. Security screening required. Enhanced cybersecurity measures. Check situational reports before deployment.</p>
            </div>
          </div>

          <div class="region med" data-region="se">
            <div class="title">
              <h3>SOUTH EAST</h3>
              <div class="tag">MEDIUM</div>
            </div>
            <p class="impact">Sit-at-home orders, aid worker targeting, IPOB attacks</p>
            <p>125% surge in attacks. 11+ killed including aid workers. Monday disruptions affecting operations.</p>
            <div class="details">
              <p><strong>SCIDaR Precautions:</strong> Avoid Monday travel to Southeast. Avoid IPOB hotspots during protests. Use security-cleared vehicles only. Consider armored escorts for high-risk movements.</p>
            </div>
          </div>

          <div class="region low" data-region="sw">
            <div class="title">
              <h3>SOUTH WEST</h3>
              <div class="tag">LOWER</div>
            </div>
            <p class="impact">Cybercrime surge, herdsmen attacks, cult activities</p>
            <p>33+ killed in Ondo/Oyo herdsmen attacks. Lagos cybercrime spike. Cult activity rising in Ogun.</p>
            <div class="details">
              <p><strong>SCIDaR Precautions:</strong> Increase cyber hygiene training. Avoid rural night travel. Security clearance for rural deployments. Enhanced IT security protocols.</p>
            </div>
          </div>
        </div>
      </section>

      <section class="guidelines">
        <div class="guide-card">
          <h4>Travel Protocols</h4>
          <ul>
            <li>Limit movements to essential trips, and travel during daylight whenever possible.</li>
            <li>Avoid journeys longer than four hours that may extend past 12 PM.</li>
            <li>Secure clearance before entering or transiting through high-risk LGAs.</li>
            <li>Share your GPS location and travel itinerary with the security focal point.</li>
            <li>Use varied travel routes and avoid establishing predictable patterns that may expose you to profiling or targeted threats.</li>
          </ul>
        </div>

        <div class="guide-card">
          <h4>Facilities & Operations</h4>
          <ul>
            <li>Maintain Low profile while at the EOC, communities and state offices</li>
            <li>Report faulty CCTV immediately to the Admin Unit</li>
            <li>Use SCIDaR secure channels for incident reporting and updates</li>
            <li>At the state level, ensure to conduct emergency drills and maintain office security protocols at all times</li>
            <li>Verify with local partners for information in high-risk areas before visiting</li>
          </ul>
        </div>

        <div class="guide-card">
          <h4>Health & Cyber Security</h4>
          <ul>
            <li>Ensure all vaccinations are up to date before deployment to designated areas.</li>
            <li>Connect only to secured networks; strictly avoid the use of public WiFi.</li>
            <li>Consume food and water only from trusted and registered vendors to reduce health risks.</li>
            <li>Complete enhanced cybersecurity training, which is mandatory for all staff.</li>
            <li>Monitor verified security channels such as @PoliceNG, @HQNigerianArmy, and ONSA/DSS for timely updates.</li>
          </ul>
        </div>
      </section>
    </div>
    

    <footer>
      <div class="left">
        <strong>SCIDaR Security Desk</strong><br>
        ðŸ“§ <a href="mailto:peter.aigbe@solinagroup.com">peter.aigbe@solinagroup.com</a> â€¢ 
        ðŸ“ž <a href="tel:+2349030857244">+234 903 085 7244</a> | 
        <a href="tel:+2348145650190">+234 814 565 0190</a> | 
        <a href="tel:+2348094917896">+234 809 491 7896</a></div>
      <div class="right">
        Internal circulation â€” September 2025<br>
        Next update: October 6, 2025
      </div>
    </footer>

<script>
  // Counter animations
  const counterObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if(entry.isIntersecting){
        const el = entry.target;
        const target = Number(el.getAttribute('data-target') || 0);
        const isPct = el.hasAttribute('data-pct');
        let current = 0;
        const steps = Math.max(20, Math.floor(target / 6));
        
        const interval = setInterval(() => {
          current += Math.max(1, Math.floor(target / steps));
          if(current >= target){
            el.textContent = isPct ? `${target}%` : (target >= 1000 ? target.toLocaleString() : (target + (el.textContent.includes('+') ? '+' : '')));
            clearInterval(interval);
          } else {
            el.textContent = isPct ? `${Math.round(current)}%` : Math.round(current);
          }
        }, 15);
        counterObserver.unobserve(el);
      }
    });
  }, { threshold: 0.3 });

  document.querySelectorAll('.num').forEach(n => counterObserver.observe(n));

  // Region toggles (cards clickable)
  document.querySelectorAll('.region').forEach(region => {
    region.addEventListener('click', (e) => {
      if (['A','BUTTON'].includes(e.target.tagName)) return;
      
      // Close others
      document.querySelectorAll('.region').forEach(r => {
        if(r !== region) r.classList.remove('active');
      });
      
      // Toggle current
      region.classList.toggle('active');
    });
  });

  // Open first region by default
  if(document.querySelector('.region')) {
    document.querySelector('.region').classList.add('active');
  }
</script>

<script>
    const WIDTH = 800, HEIGHT = 600;

    const svg = d3.select("#map")
      .append("svg")
      .attr("viewBox", `0 0 ${WIDTH} ${HEIGHT}`)
      .attr("preserveAspectRatio", "xMidYMid meet");

    const g = svg.append("g");

    const projection = d3.geoMercator().scale(1).translate([0,0]);
    const path = d3.geoPath().projection(projection);

    const tooltip = d3.select("#tooltip");

    // Define geopolitical zones with colors
    const zones = {
      "North Central": ["Benue", "Kogi", "Kwara", "Nassarawa", "Niger", "Plateau", "Federal Capital Territory"],
      "North East": ["Adamawa", "Bauchi", "Borno", "Gombe", "Taraba", "Yobe"],
      "North West": ["Jigawa", "Kaduna", "Kano", "Katsina", "Kebbi", "Sokoto", "Zamfara"],
      "South East": ["Abia", "Anambra", "Ebonyi", "Enugu", "Imo"],
      "South South": ["Akwa Ibom", "Bayelsa", "Cross River", "Delta", "Edo", "Rivers"],
      "South West": ["Ekiti", "Lagos", "Ogun", "Ondo", "Osun", "Oyo"]
    };

    const zoneColors = {
      "North Central": "#f4a261",
      "North East": "#e76f51",
      "North West": "#e76f51",
      "South East": "#f4a261",
      "South South": "#f4a261",
      "South West": "#8ab17d"
    };

    function getZone(state) {
      for (const [zone, states] of Object.entries(zones)) {
        if (states.includes(state)) return zone;
      }
      return null;
    }

    // map zone name -> data-region code used in cards
    const zoneCodes = {
      "North Central":"nc","North East":"ne","North West":"nw",
      "South East":"se","South South":"ss","South West":"sw"
    };

    let geoData = null;

    d3.json("sample.geojson").then(data => {
      geoData = data;
      // fit projection to the viewBox
      projection.fitSize([WIDTH, HEIGHT], geoData);

      // Draw states
      g.selectAll("path")
        .data(data.features)
        .enter().append("path")
        .attr("class", "state")
        .attr("d", path)
        .attr("fill", d => {
          const zone = getZone(d.properties.name);
          return zone ? zoneColors[zone] : "#ccc";
        })
        .attr("stroke","#333")
        .attr("stroke-width",0.5)
        .on("mouseover", (event, d) => {
          const zone = getZone(d.properties.name);
          tooltip.style("opacity", 1)
                 .html("<b>" + d.properties.name + "</b><br/>Zone: " + (zone || "Unknown"))
                 .style("left", (event.pageX + 10) + "px")
                 .style("top", (event.pageY - 20) + "px");
        })
        .on("mouseout", () => {
          tooltip.style("opacity", 0);
        })
        .on("click", (event, d) => {
          // clear previous selection
          g.selectAll(".state").classed("selected", false);
          d3.select(event.currentTarget).classed("selected", true);

          // find zone and corresponding card
          const zoneName = getZone(d.properties.name);
          if (!zoneName) return;
          const code = zoneCodes[zoneName];
          const card = document.querySelector(`.region[data-region="${code}"]`);
          if (card) {
            // scroll and open details and strongly highlight
            const headerOffset = Math.min(window.innerHeight*0.12, 120); // approximate header offset
            const rect = card.getBoundingClientRect();
            const currentScroll = window.scrollY || window.pageYOffset;
            const targetY = currentScroll + rect.top - headerOffset - (window.innerHeight*0.08);
            window.scrollTo({ top: targetY, behavior: "smooth" });

            // remove highlight from others
            document.querySelectorAll('.region').forEach(r => r.classList.remove('highlight'));
            card.classList.add('highlight');
            card.classList.add('active'); // auto-open details

            // remove highlight after a visible duration
            setTimeout(()=>card.classList.remove('highlight'), 2000);

            // NOTE: map summary panel was intentionally removed per your request
          }
        });

      // ---- Add Zone Labels ----
      for (const [zone, states] of Object.entries(zones)) {
        const zoneStates = data.features.filter(f => states.includes(f.properties.name));
        if (zoneStates.length > 0) {
          // Calculate average centroid of all states in this zone
          const centroids = zoneStates.map(f => path.centroid(f));
          const avgX = d3.mean(centroids, d => d[0]);
          const avgY = d3.mean(centroids, d => d[1]);

          g.append("text")
            .attr("class", "zone-label")
            .attr("x", avgX)
            .attr("y", avgY)
            .text(zone);
        }
      }
    }).catch(err=>{
      console.error("geojson load error:",err);
      d3.select("#map").append("div").style("padding","12px").text("Map failed to load.");
    });

    // Zoom behavior with constrained bounds
    const zoom = d3.zoom()
      .scaleExtent([0.5, 8])
      .translateExtent([[-100, -100], [WIDTH + 100, HEIGHT + 100]]) // Constrain panning
      .on("zoom", (event) => {
        g.attr("transform", event.transform);
      });

    svg.call(zoom);

    // Zoom buttons
    d3.select("#zoom_in").on("click", () => svg.transition().call(zoom.scaleBy, 1.5));
    d3.select("#zoom_out").on("click", () => svg.transition().call(zoom.scaleBy, 0.75));
    d3.select("#reset").on("click", () => svg.transition().call(zoom.transform, d3.zoomIdentity));

    // resize: when window resizes, recompute fit (keeps map nicely scaled)
    let resizeDeb;
    window.addEventListener('resize', ()=> {
      if(!geoData) return;
      clearTimeout(resizeDeb);
      resizeDeb = setTimeout(()=>{ 
        projection.fitSize([WIDTH, HEIGHT], geoData);
        // redraw paths and labels to use new projection
        d3.selectAll('path.state').attr('d', path);
        d3.selectAll('text.zone-label').remove();
        for (const [zone, states] of Object.entries(zones)) {
          const zoneStates = geoData.features.filter(f => states.includes(f.properties.name));
          if (zoneStates.length > 0) {
            const centroids = zoneStates.map(f => path.centroid(f));
            const avgX = d3.mean(centroids, d => d[0]);
            const avgY = d3.mean(centroids, d => d[1]);
            g.append("text")
              .attr("class", "zone-label")
              .attr("x", avgX)
              .attr("y", avgY)
              .text(zone);
          }
        }
      }, 120);
    });
  </script>

<script>
    const sidebar = document.getElementById("sidebar");
    const toggleBtn = document.getElementById("toggleBtn");

    function updateToggleLabel(){
      // small screens: use icon only but keep it visible; when open show a close icon
      if(window.innerWidth <= 420){
        toggleBtn.textContent = sidebar.classList.contains('open') ? "âœ–" : "ðŸ“… Next Update";
      } else {
        toggleBtn.textContent = sidebar.classList.contains('open') ? "âœ– Close" : "ðŸ“… Next Update";
      }
    }
    // initialize label
    updateToggleLabel();
    window.addEventListener('resize', updateToggleLabel);

    toggleBtn.addEventListener("click", () => {
      sidebar.classList.toggle("open");
      updateToggleLabel();
      // do NOT hide the toggle button â€” user requested the close button to remain
    });

    // If user clicks outside sidebar (desktop) close it â€” but ignore clicks inside map area
    document.addEventListener('click', (e)=>{
      if(sidebar.classList.contains('open') && !sidebar.contains(e.target) && !toggleBtn.contains(e.target)){
        if(!e.target.closest('#map') && window.innerWidth > 600){
          sidebar.classList.remove('open');
          updateToggleLabel();
        }
      }
    });
  </script>
</body>
</html>
